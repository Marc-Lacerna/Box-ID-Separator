<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <title>Box ID Separator Tools</title>

  <!-- Plugin Design and jquery -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-ENjdO4Dr2bkBIFxQpeoTz1HIcje39Wm4jDKdf19U8gI4ddQ3GYNS7NTKfAdVQSZe" crossorigin="anonymous">
      </script>

    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/5.3.0/css/bootstrap.min.css" rel="stylesheet">

    <script src="https://code.jquery.com/jquery-3.7.0.js"></script>


    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.13.2/themes/base/jquery-ui.min.css" rel="stylesheet" />
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.13.2/jquery-ui.min.js"></script>
  <!-- End of Plugin Design and Jquery -->
  
  <style>
    /* Custom styles to handle the z-index of modals and backdrops */
      .modal-backdrop {
        z-index: 1040 !important;
        /* Lower z-index for the first backdrop */
      }

      .modal-backdrop-top {
        z-index: 1060 !important;
        /* Higher z-index for the second backdrop */
      }

      .modal {
        z-index: 1050 !important;
        /* Lower z-index for the first modal */
      }

      .modal-top {
        z-index: 1070 !important;
        /* Higher z-index for the second modal */
      }

      .btn-custom {
        font-size: 0.5rem;
        padding: 0.25rem 0.5rem;
      }

      .navbar-toggler {
        width: 50px;
        height: 50px;
        padding: 0;
        border-radius: 50%;
        transition: 0.3s ease-in-out;
        flex-shrink: 0;
      }

      .navbar-toggler:focus {
        box-shadow: none;
      }

      @media screen and (max-width: 991px) {
        .navbar-collapse.collapse:not(.show) {
          display: block;
        }

        .navbar-collapse {
          position: fixed;
          top: 0;
          left: 0;
          background: #212529;
          width: 215px;
          height: 100%;
          z-index: 9999;
          padding: 25px;
          transform: translateX(-215px);
          transition: 0.5s ease-in-out;
          display: block;
        }

        .navbar-collapse.show {
          transform: translateX(0px);
        }

        .nav-overlay {
          position: absolute;
          background: #0000007d;
          width: 100vw;
          height: 100vh;
          top: 0;
          left: 0;
          z-index: 5;
          transform: translateX(-100vw);
          transition: 0.5s ease-in-out;
          display: block;
        }

        .nav-overlay.active {
          transform: translateX(0);
        }
      }

      body {
        font-family: Arial, sans-serif;
        margin: 0;
        padding: 0;
      }

      #stats {
        position: sticky;
        top: 0;
        background: #fff;
        padding: 12px 20px;
        font-weight: bold;
        border-bottom: 2px solid #ddd;
        z-index: 3;
      }

      #container {
        padding: 20px;
      }

      .scan-box {
        border: 1px solid #ccc;
        padding: 16px;
        border-radius: 8px;
        margin-bottom: 20px;
      }

      .scan-row {
        display: flex;
        align-items: center;
        flex-wrap: wrap;
        gap: 10px;
        margin-bottom: 12px;
      }

      input[type="text"] {
        padding: 6px;
        border: 2px solid #ccc;
        border-radius: 4px;
      }

      .split-item-input {
        flex: 1;
        padding: 6px;
        border: 2px solid #ccc;
        border-radius: 4px;
      }

      .copied {
        border-color: green !important;
        background-color: #e6ffe6;
      }

      .box-id {
        display: none;
        font-weight: bold;
        border: 2px solid blue;
        background-color: #eef6ff;
      }

      .copy-boxid-btn {
        display: none;
        cursor: pointer;
      }

      .input-group {
        display: flex;
        align-items: center;
        gap: 8px;
        margin-bottom: 8px;
      }

      .box-controls {
        display: flex;
        justify-content: flex-end;
        gap: 10px;
        margin-top: 10px;
      }

      button {
        padding: 6px 12px;
        cursor: pointer;
      }

      .hidden {
        display: none !important;
      }
    /*End of Custom Design*/
  </style>

</head>

<body>
  <header>
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
      <div class="container-fluid">
        <a class="navbar-brand" href="#">Flosonics Medical</a>
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent"
          aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="nav-overlay"></div>
        <div class="collapse navbar-collapse" id="navbarSupportedContent">
          <ul class="navbar-nav me-auto mb-2 mb-lg-0">
            <li class="nav-item">
              <a class="nav-link active" aria-current="page" href="#">Box ID
                Separator v1.0</a>
            </li>
          </ul>
        </div>
      </div>
    </nav>
  </header>

  <div id="contentDiv" style="margin:1%">
    <div class="card">
      <div class="card-body">
        <div class="row">
          <div class="col-md-12">

            <div id="stats">
              Total Box IDs: <span id="total-boxes">0</span> |
              Total Inputs: <span id="total-inputs">0</span>
            </div>

            <div id="container"></div>
            <button class="btn btn-info" onclick="addScanBox()">Add New Scan Box</button>

          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    let scanBoxCounter = 0;
    const scannedBoxIds = new Set();
    const scannedValues = new Set();
    $(document).ready(function () {
      const button = document.querySelector(".navbar-toggler");
      const navOverlay = document.querySelector(".nav-overlay");
      const navbarCollapse = document.querySelector(".navbar-collapse");

      button.addEventListener("click", function () {
        navOverlay.classList.toggle("active");
      });

      navOverlay.addEventListener("click", function (event) {
        if (event.target === navOverlay) {
          navOverlay.classList.remove("active");
          navbarCollapse.classList.remove("show");
        }
      });

    });

    function addScanBox() {
      const container = document.getElementById("container");
      const boxId = `scan-box-${scanBoxCounter++}`;

      const scanBox = document.createElement("div");
      scanBox.className = "scan-box";
      scanBox.id = boxId;

      scanBox.innerHTML = `
          <div class="scan-row">

            <label for="${boxId}-boxid" class="boxid-label" style="display:none;">Box ID:</label>

            <input type="text" id="${boxId}-boxid" class="box-id form-control" readonly />
            <button class="btn btn-primary copy-boxid-btn" onclick="copyBoxId('${boxId}')">Copy ID</button>

          <div class="input-group mb-3">
              <div class"input-group-prepend">
              <button class="btn btn-success" id="${boxId}-split-btn" onclick="processScan('${boxId}')">Split</button>
            </div>
            <input  type="text" id="${boxId}-scan" placeholder="Scan comma-separated values" />
          </div>
          
          </div>
          <div id="${boxId}-output" class="output-container"></div>
          <div class="box-controls">
            <button class="btn btn-warning" onclick="clearBox('${boxId}')">Clear Values</button>
            <button class="btn btn-danger" onclick="deleteBox('${boxId}')">Delete Box</button>
          </div>
        `;

      container.appendChild(scanBox);
    }

    function processScan(boxId) {
      const input = document.getElementById(`${boxId}-scan`);
      const splitBtn = document.getElementById(`${boxId}-split-btn`);
      const outputDiv = document.getElementById(`${boxId}-output`);
      const boxIdInput = document.getElementById(`${boxId}-boxid`);
      const copyBtn = boxIdInput.nextElementSibling;
      const label = boxIdInput.previousElementSibling;

      const values = input.value.split(',').map(v => v.trim()).filter(v => v);
      outputDiv.innerHTML = "";
      if (values.length === 0) return;

      const currentBoxId = values[0];

      if (scannedBoxIds.has(currentBoxId)) {
        alert(`Box ID "${currentBoxId}" has already been scanned!`);
        return;
      }

      const duplicates = values.slice(1).filter(val => scannedValues.has(val));
      if (duplicates.length > 0) {
        alert(`Duplicate value(s) found: ${duplicates.join(', ')}`);
        return;
      }

      scannedBoxIds.add(currentBoxId);
      values.slice(1).forEach(val => scannedValues.add(val));

      // Show Box ID
      boxIdInput.style.display = "inline-block";
      copyBtn.style.display = "inline-block";
      label.style.display = "inline-block";
      boxIdInput.value = currentBoxId;

      // Hide scan input and split button
      input.classList.add("hidden");
      splitBtn.classList.add("hidden");

      // Display each input
      for (let i = 1; i < values.length; i++) {
        const val = values[i];
        const inputGroup = document.createElement("div");
        inputGroup.className = "input-group";

        const itemInput = document.createElement("input");
        itemInput.type = "text";
        itemInput.value = val;
        itemInput.readOnly = true;
        itemInput.id = `${boxId}-item-${i}`;
        itemInput.className = "form-control";

        const copyBtn = document.createElement("button");
        copyBtn.innerText = "Copy";
        copyBtn.onclick = () => copyInput(itemInput);
        copyBtn.className = "btn btn-primary";

        inputGroup.appendChild(copyBtn);
        inputGroup.appendChild(itemInput);
        outputDiv.appendChild(inputGroup);
      }

      input.value = "";
      updateStats();
    }

    function copyInput(inputElement) {
      inputElement.select();
      inputElement.setSelectionRange(0, 99999);
      try {
        document.execCommand("copy");
        inputElement.classList.add("copied");
      } catch {
        alert("Copy failed.");
      }
    }

    function copyBoxId(boxId) {
      const boxIdInput = document.getElementById(`${boxId}-boxid`);
      if (!boxIdInput.value) {
        alert("Box ID is empty!");
        return;
      }
      copyInput(boxIdInput);
    }

    function updateStats() {
      document.getElementById("total-boxes").textContent = scannedBoxIds.size;
      document.getElementById("total-inputs").textContent = scannedValues.size;
    }

    function clearBox(boxId) {
      const boxIdInput = document.getElementById(`${boxId}-boxid`);
      const outputDiv = document.getElementById(`${boxId}-output`);
      const scanInput = document.getElementById(`${boxId}-scan`);
      const splitBtn = document.getElementById(`${boxId}-split-btn`);

      const currentBoxId = boxIdInput.value.trim();
      if (scannedBoxIds.has(currentBoxId)) {
        scannedBoxIds.delete(currentBoxId);
      }

      const inputs = outputDiv.querySelectorAll("input");
      inputs.forEach(input => {
        const val = input.value.trim();
        if (scannedValues.has(val)) {
          scannedValues.delete(val);
        }
      });

      // Reset UI
      boxIdInput.value = "";
      boxIdInput.style.display = "none";
      boxIdInput.previousElementSibling.style.display = "none";
      boxIdInput.nextElementSibling.style.display = "none";

      scanInput.value = "";
      outputDiv.innerHTML = "";

      // Show scan input and split button
      scanInput.classList.remove("hidden");
      splitBtn.classList.remove("hidden");

      updateStats();
    }

    function deleteBox(boxId) {
      clearBox(boxId); // Ensure cleanup
      const box = document.getElementById(boxId);
      if (box) box.remove();
    }

    window.onload = () => addScanBox();
  </script>
</body>

</html>